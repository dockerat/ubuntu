#!/bin/bash
### 使用方法：property key value filename

if [ -z "$1" ]; then
  echo "没有参数，退出..."
  exit 1
fi

if [ -z "$2" ]; then
  echo "只设置了Key没有设置Value，退出..."
  exit 1
fi

if [ -z "$3" ] && [ -z "$setFilename" ]; then
  echo "没有设置文件名，退出..."
  exit 1
fi

if [ "$setFilename" ] && [ "$3" ]; then
    echo "文件名是内置命令，退出..."
    exit 1
else
  if [ "$3" ] && [ ! -f "$3" ]; then
    echo "文件不存在，退出..."
    exit 1
  elif [ "$setFilename" ] && [ ! -f "$setFilename" ]; then
    echo "文件中没有找到Key，退出..."
    exit 1
  fi
fi

if [ "$setFilename" ]; then
  file=$setFilename
else
  file=$3
fi

awk -v pat="^$1=" -v value="$1=$2" '{ if ($0 ~ pat) print value; else print $0; }' "$file" > "$file".tmp
mv "$file".tmp "$file"
